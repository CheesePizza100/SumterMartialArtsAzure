<h2 mat-dialog-title>Record Test Result</h2>

<mat-dialog-content>
  <div class="dialog-form">
    <p class="student-info">
      Recording test for: <strong>{{ data.studentName }}</strong>
    </p>

    <!-- Program Selection -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Program</mat-label>
      <mat-select [(ngModel)]="selectedProgramId" required>
        <mat-option *ngFor="let program of data.programs" [value]="program.id">
          {{ program.name }} (Current: {{ program.currentRank }})
        </mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Rank Being Tested -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Rank Being Tested</mat-label>
      <input matInput [(ngModel)]="rankTested" placeholder="e.g., Blue Belt, Stripe 1" required>
      <mat-hint *ngIf="selectedProgram">
        Current rank: {{ selectedProgram.currentRank }}
      </mat-hint>
    </mat-form-field>

    <!-- Test Result -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Result</mat-label>
      <mat-select [(ngModel)]="result" required>
        <mat-option value="Pass">Pass</mat-option>
        <mat-option value="Fail">Fail</mat-option>
      </mat-select>
    </mat-form-field>

    <!-- Test Date -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Test Date</mat-label>
      <input matInput [matDatepicker]="picker" [(ngModel)]="testDate" required>
      <mat-datepicker-toggle matSuffix [for]="picker"></mat-datepicker-toggle>
      <mat-datepicker #picker></mat-datepicker>
    </mat-form-field>

    <!-- Instructor Notes -->
    <mat-form-field appearance="outline" class="full-width">
      <mat-label>Instructor Notes</mat-label>
      <textarea matInput
                [(ngModel)]="notes"
                rows="4"
                placeholder="Enter detailed notes about the test performance..."
                required></textarea>
      <mat-hint>Required - provide feedback on technique, areas of improvement, etc.</mat-hint>
    </mat-form-field>

    <!-- Event Sourcing Info -->
    <div class="info-box" *ngIf="result === 'Pass'">
      <span>
        Recording this test will create events in the event store and automatically promote
        the student to <strong>{{ rankTested }}</strong> in {{ selectedProgram?.name }}.
      </span>
    </div>

    <div class="warning-box" *ngIf="result === 'Fail'">
      <span>
        This test result will be recorded in the event store, but the student will
        remain at their current rank ({{ selectedProgram?.currentRank }}).
      </span>
    </div>
  </div>
</mat-dialog-content>

<mat-dialog-actions align="end">
  <button mat-button (click)="onCancel()" [disabled]="isSubmitting">
    Cancel
  </button>
  <button mat-raised-button
          color="primary"
          (click)="onSubmit()"
          [disabled]="!canSubmit">
    <mat-spinner diameter="20" *ngIf="isSubmitting"></mat-spinner>
    <span *ngIf="!isSubmitting">Record Test Result</span>
  </button>
</mat-dialog-actions>
